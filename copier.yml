_min_copier_version: '9.5.0'
_subdirectory: template
_answers_file: .copier-answers.yml

type:
  type: str
  choices:
    - base
    - node
    - rust
  default: base
  help: Project type (base = minimal template, node = Node.js/TypeScript project, rust = Rust project)

# Note: _folder_name cannot be used because it resolves to a temporary directory
# path during copier update. See: https://github.com/copier-org/copier/issues/1285
project_name:
  type: str
  help: Project name
  default: '{{ _folder_name }}'

description:
  type: str
  help: Project description for README.md
  default: ''

# README.md is expected to be customized immediately after repository creation,
# so conflicts are almost guaranteed on copier update. Skip to avoid this.
_skip_if_exists:
  - README.md

# Exclude files that are specific to this template repository
# and not needed in derived repositories
_exclude:
  # Exclude external refs plugin for private repos
  - '{% if not is_public %}commitlint-plugin-no-external-refs.cjs{% endif %}'
  # Conditional exclusion when release-please is disabled.
  # NOTE: Copier's _exclude matches against OUTPUT file names (without .jinja
  # suffix), not source file names.
  #
  #   _exclude pattern                 | use_release_please=true | =false
  #   ---------------------------------|-------------------------|----------
  #   release-please-config.json       | generated               | excluded
  #   release-please-config.json.jinja | generated               | generated
  - '{% if not use_release_please %}release-please-config.json{% endif %}'
  - '{% if not use_release_please %}.release-please-manifest.json{% endif %}'
  - '{% if not use_release_please %}.github/workflows/release-please.yml{% endif %}'
  - '{% if not use_release_please %}.github/workflows/test-release-please.yml{% endif %}'
  # Exclude Node.js specific files when type is not 'node'
  # Use leading / to match root only (not yield subpackage directories)
  - "{% if type != 'node' and not (monorepo_node_workspace | default(false)) %}/package.json{% endif %}"
  - "{% if type != 'node' %}/tsconfig.json{% endif %}"
  - "{% if type != 'node' and not (monorepo_node_workspace | default(false)) %}/eslint.config.js{% endif %}"
  - "{% if type != 'node' %}/vitest.config.ts{% endif %}"
  # pnpm-workspace.yaml only when workspace is enabled (workspace requires pnpm)
  - '{% if not (monorepo_node_workspace | default(false)) %}/pnpm-workspace.yaml{% endif %}'
  # Exclude CLAUDE.md when no Rust code (only contains Rust test rules)
  - "{% if type != 'rust' and not (subpackages | selectattr('type', 'equalto', 'rust') | list) %}/CLAUDE.md{% endif %}"
  # Exclude Rust specific files when type is not 'rust'
  - "{% if type != 'rust' %}/Cargo.toml{% endif %}"
  - "{% if type != 'rust' %}/rust-toolchain.toml{% endif %}"
  - "{% if type != 'rust' %}/clippy.toml{% endif %}"
  - "{% if type != 'rust' and not (subpackages | selectattr('type', 'equalto', 'rust') | list) %}/sgconfig.yml{% endif %}"
  - "{% if type != 'rust' and not (subpackages | selectattr('type', 'equalto', 'rust') | list) %}/.sg{% endif %}"
  - "{% if type != 'rust' %}/src/main.rs{% endif %}"
  # Exclude Node.js specific src files when type is not 'node'
  - "{% if type != 'node' %}/src/index.ts{% endif %}"
  - "{% if type != 'node' %}/src/index.test.ts{% endif %}"
  # Exclude coverage files when coverage is disabled
  - '{% if not use_coverage %}/codecov.yml{% endif %}'
  # Exclude type-specific files
  - "{% if type not in ['node', 'rust'] and not (monorepo_node_workspace | default(false)) and not (subpackages | selectattr('type', 'equalto', 'rust') | list) %}/.gitignore{% endif %}"
  - "{% if type not in ['node', 'rust'] %}/src{% endif %}"

# Template parameters
is_public:
  type: bool
  default: false
  help: Is this a public repository?

# release-please settings
use_release_please:
  type: bool
  default: false
  help: Enable automated release management with release-please?

release_type:
  type: str
  choices:
    - simple
    - node
    - python
    - go
    - rust
    - java
  help: Select the release-type for your project
  when: '{{ use_release_please }}'

auto_merge_release_pr:
  type: bool
  default: false
  help: Automatically merge release-please PRs?
  when: '{{ use_release_please }}'

release_binary:
  type: bool
  default: false
  help: Build and upload release binaries?
  when: "{{ type == 'rust' and use_release_please }}"

binary_name:
  type: str
  help: Name of the binary to build
  when: '{{ release_binary }}'

# Monorepo subpackage definitions.
# When non-empty, infrastructure files (test.yml, lefthook, renovate, etc.)
# are generated in monorepo mode.
# Input via --data-file is recommended for this parameter.
subpackages:
  type: yaml
  multiline: true
  default: []
  help: |
    Subpackage definitions for monorepo.
    Example: [{name: frontend, type: node}, {name: backend, type: rust}]
  when: "{{ type == 'base' }}"

# Placed after subpackages so the when condition can reference it in interactive mode
node_package_manager:
  type: str
  choices:
    - bun
    - pnpm
  default: bun
  help: Node.js package manager to use
  when: "{{ type == 'node' or (subpackages | selectattr('type', 'equalto', 'node') | list | length > 0) }}"

# Placed after node_package_manager so the default/validator can reference it in interactive mode
monorepo_node_workspace:
  type: bool
  help: Enable pnpm workspace for monorepo (hoists shared devDependencies to root)
  when: "{{ type == 'base' and (subpackages | selectattr('type', 'equalto', 'node') | list | length > 0) }}"
  default: "{{ node_package_manager == 'pnpm' and (subpackages | selectattr('type', 'equalto', 'node') | list | length) >= 2 }}"
  validator: >-
    {% if monorepo_node_workspace and node_package_manager != 'pnpm' %}
    monorepo_node_workspace requires pnpm as the package manager. bun workspace is not supported.
    {% endif %}

use_coverage:
  type: bool
  default: false
  help: Enable code coverage with cargo-llvm-cov and Codecov?
  when: "{{ type == 'rust' or (subpackages | selectattr('type', 'equalto', 'rust') | list | length > 0) }}"
